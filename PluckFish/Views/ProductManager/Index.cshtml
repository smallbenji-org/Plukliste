@model PluckFish.Controllers.ProductViewModel
@{
    ViewData["Title"] = "Produktstyring";
}

<div class="card">
    <h2>Tilføj nyt produkt</h2>
    <form asp-action="Index" method="post" class="add-product-form">
        <div class="form-group">
            <label class="label" for="prodName">Produktnavn:</label>
            <input class="list-dropdown" id="prodName" name="prodName" />
            <span class="text-danger"></span>
        </div>
        <div class="form-group">
            <label class="label" for="prodID">Produkt ID:</label>
            <input class="list-dropdown" id="prodID" name="prodID" />
            <span class="text-danger"></span>
        </div>
        <div class="form-group">
            <input type="submit" value="Tilføj Produkt" class="confirm-btn" />
        </div>
    </form>
</div>

<div class="card">
    <h2>Eksisterende Produkter</h2>
    <div class="row2">
        <div class="form-group search-container wide" style="margin-bottom: 1rem;">
            <input type="text" id="productSearch" class="form-control" placeholder="Søg Varer..." style="width: 25vw;">
            <div class="search-icon">
                <svg data-slot="icon" fill="none" stroke-width="1.5" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                    <path stroke-linecap="round" stroke-linejoin="round" d="m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z"></path>
                </svg>
            </div>
        </div>
        <form asp-action="" method="post" class="card-button twenty-percent no-margin">
            <button class="create-btn" type="submit"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-plus"><path stroke="none" d="M0 0h24v24H0z" fill="none" /><path d="M12 5l0 14" /><path d="M5 12l14 0" /></svg>Importer fil</button>
        </form>
    </div>
    <div id="product-table-container">
        @await Html.PartialAsync("~/Views/ProductManager/_ProductTablePartial.cshtml", Model)
    </div>
</div>

<script>
    const tableContainer = document.getElementById("product-table-container");

    async function loadTable(url) {
        try {
            const response = await fetch(url);
            const html = await response.text();
            tableContainer.innerHTML = html;
            window.history.pushState({ path: url }, '', url.replace('GetProductTable', 'ScrollPage'));
        } catch (error) {
            console.error('Failed to load table content:', error);
        }
    }

    tableContainer.addEventListener("click", function (e) {
        if (e.target.closest('.pagination a')) {
            e.preventDefault();
            const link = e.target.closest('.pagination a');
            loadTable(link.href);
        }
    });

    document.getElementById("productSearch").addEventListener("input", function () {
    let filter = this.value.toLowerCase();
    let rows = document.querySelectorAll("#produkter tr");

    rows.forEach(row => {
        let productName = row.querySelector(".produktnavn").textContent.toLowerCase();
        row.style.display = productName.includes(filter) ? "" : "none";
            });
    });
</script>